{% extends "base.html" %}
{% set active_page = "results" %}

{% block content %}
<h1>Results for Week {{polls[page-1].week}} of {{polls[page-1].season-1}}-{{polls[page-1].season-2000}}<button class="reddit-table btn btn-info pull-right">Get Reddit Formatted Table</button>
</h1>
<hr>
{% include 'resulttable.html' %}
<ul class="pager">
{% if polls[page-1].has_next %}<li class="previous"><a href="{{ url_for('index', page = polls[page-1].next_num) }}">&larr; Older</a></li>{% else %}{% endif %}
{% if polls[page-1].has_prev %}<li class="next"><a href="{{ url_for('index', page = poll[page-1].prev_num) }}">Newer &rarr;</a></li>{% else %}{% endif %}
</ul>
<div class="pop-bg">
	&nbsp;
</div>
<div class="pop">
  <span>âœ–</span>
  <h3>Reddit Formatted Table</h3>
  <textarea readonly>
Rank||Team|Score(First Place Votes)
:--:|:--:|:---|:---
{% set prev_score = -1 -%}
{%- for result in results -%}
  {% set team = teams.get(result[0]) %}
    {%- if loop.index < 26 -%}
      {%- if result[1][0] == prev_score -%}
        {%- set rank = prev_rank -%}
      {%- else -%}
        {%- set rank = loop.index -%}
      {%- endif -%}
    {%- set prev_rank = rank -%}
    {%- set prev_score = result[1][0] -%}
#{{rank}}|{%- if team.flair -%}[](/{{team.flair}}){%-endif-%}|{%-if team.short_name-%}{{team.short_name}}{%-else-%}{{team.full_name}}{%-endif-%}|{{ result[1][0]}}{%- if result[1][1] -%}({{result[1][1]}}){%-endif-%}
{% elif loop.index == 26 %}

Others Receiving Votes: {{team.short_name}}({{result[1][0]}}){%- else -%}, {{ team.short_name }}({{result[1][0]}})
{%- endif -%}
{% endfor %}
  </textarea>
</div>

<div>
  <h5>Official Ballots</h5>
  {% for ballot in official_ballots %}
  {%- if loop.index != 1 %}, {% endif %}
  <a href="{{ url_for('ballot', ballot_id=ballot.id) }}">{{users.get(ballot.user_id).nickname}}</a>
  {%- endfor %}
  <h5>Provisional Ballots</h5>
  {% for ballot in provisional_ballots %}
  {%- if loop.index != 1 -%}, {%- endif -%}
  <a href="{{ url_for('ballot', ballot_id=ballot.id) }}">{{users.get(ballot.user_id).nickname}}</a>
  {% endfor %}
</div>

{% endblock %}
{% block scripts %} 
{{super()}}
<script>
 $(document).ready(function () {
     $(".reddit-table").click(function () {
         $(".pop, .pop-bg").fadeIn(100);
         positionPopup();
     });

     $(".pop > span, .pop-bg").click(function () {
         $(".pop, .pop-bg").fadeOut(100);
     });
 });
</script>
{% endblock %}
